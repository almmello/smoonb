/**
 * Comando de configura√ß√£o do smoonb
 */

const chalk = require('chalk');
const fs = require('fs').promises;
const path = require('path');
const os = require('os');

async function configCommand(options) {
  console.log(chalk.red.bold('üöÄ smoonb v0.0.1 - EXPERIMENTAL VERSION'));
  console.log(chalk.red.bold('‚ö†Ô∏è  VERS√ÉO EXPERIMENTAL - NUNCA TESTADA EM PRODU√á√ÉO!'));
  console.log(chalk.red.bold('üö® USE POR SUA CONTA E RISCO - Pode causar perda de dados!'));
  console.log(chalk.red.bold('‚ùå N√ÉO NOS RESPONSABILIZAMOS por qualquer perda de dados!\n'));
  
  console.log(chalk.cyan.bold('‚öôÔ∏è  Configura√ß√£o do smoonb...\n'));

  try {
    const configPath = path.join(os.homedir(), '.smoonbrc');

    if (options.init) {
      // Inicializar configura√ß√£o
      const defaultConfig = {
        supabase: {
          projectId: '',
          url: '',
          serviceKey: '',
          anonKey: '',
          databaseUrl: ''
        },
        backup: {
          includeFunctions: true,
          includeStorage: true,
          includeAuth: true,
          includeRealtime: true,
          outputDir: './backups'
        },
        restore: {
          cleanRestore: false,
          verifyAfterRestore: true
        }
      };

      await fs.writeFile(configPath, JSON.stringify(defaultConfig, null, 2));
      console.log(chalk.green('‚úÖ Arquivo de configura√ß√£o criado:'), configPath);
      console.log(chalk.yellow('üí° Edite o arquivo para configurar suas credenciais Supabase'));

    } else if (options.show) {
      // Mostrar configura√ß√£o atual
      try {
        const configContent = await fs.readFile(configPath, 'utf8');
        const config = JSON.parse(configContent);
        
        console.log(chalk.green('üìã Configura√ß√£o atual:'));
        console.log(chalk.blue('üìÅ Arquivo:'), configPath);
        console.log(chalk.gray(JSON.stringify(config, null, 2)));

      } catch (error) {
        console.log(chalk.yellow('‚ö†Ô∏è  Arquivo de configura√ß√£o n√£o encontrado'));
        console.log(chalk.yellow('üí° Use'), chalk.cyan('smoonb config --init'), chalk.yellow('para criar a configura√ß√£o'));
      }

    } else {
      // Mostrar ajuda
      console.log(chalk.yellow('üí° Op√ß√µes dispon√≠veis:'));
      console.log(chalk.cyan('  --init'), chalk.gray('  Inicializar arquivo de configura√ß√£o'));
      console.log(chalk.cyan('  --show'), chalk.gray('  Mostrar configura√ß√£o atual'));
      console.log(chalk.blue('\nüìÅ Arquivo de configura√ß√£o:'), configPath);
    }

  } catch (error) {
    console.error(chalk.red.bold('‚ùå Erro durante a configura√ß√£o:'), error.message);
    process.exit(1);
  }
}

module.exports = configCommand;
